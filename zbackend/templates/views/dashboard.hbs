<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia | Dashboard</title>

    <!-- CSS LINK -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
        *{
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            scroll-padding-top: 2rem;
            scroll-behavior: smooth;
            box-sizing: border-box;
            list-style: none;
            text-decoration: none;
    
            cursor: url(../image/cursor.png), auto;
        }

        body{
            background-color: #f1f1f1;
        }
        h2{
            color: #171427;
        }
        

        :root{
            --main-color: #131924;
            --text-color: #131924;
            --bg-color: #fff;
        }
        body::-webkit-scrollbar{
            display: none;
        }

        .cart::-webkit-scrollbar{
            display: none;
        }
        img{
            width: 100%;
        }
        .container{
            max-width: 1068px;
            margin: auto;
            width: 100%;
            color: #fff;
        }
        header{
            position: fixed;
            color: #fff;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--text-color);
            box-shadow: 0 1px 4px hsl(0 4% 15% / 10%);
            z-index: 100;
        }
        .nav{
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
        }
        .textnew{
            color: white;
        }
        .nav i{
            color: #171427;
        }
        .logo{
            font-size: 2rem;
            color: var(--bg-color);
            font-weight: 600;
        }
        .navlist{
            color: #fff;
        }
        .navlist{
            justify-content: space-around;
        }
        #cart-icon{
            font-size: 1.5rem;
            color: #fff;
        }
        .cart{
            position: fixed;
            top: 0;
            right: -100%;
            width: 360px;
            min-height: 100vh;
            max-height: 100vh;
            overflow-y: auto;
            padding: 20px;
            background: var(--bg-color);
            box-shadow: -2px 0 4px hsl(0 4% 15% / 10%);
            transition: .3s ease;
            
        }
        .cart.active{
            right: 0;
        }
        .cart-title{
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1rem;
            color: var(--main-color);
        }

        .cart-content{
            color: var(--main-color);
            width: 800;
        }
        .cart-box{
            display: grid;
            grid-template-columns: 32% 50% 18%;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        .cart-img{
            width: 100px;
            height: 100px;
            object-fit: contain;
            padding: 10px;
        }
        .cart-price{
            font-weight: 500;
        }
        .cart-quantity{
            outline-color: var(--main-color);
            width: 2.4rem;
            text-align: center;
            font-size: 1rem;
        }
        .cart-remove {
            font-size: 24px;
            cursor: pointer;
        }
        .cart-product-title{
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .detail-box{
            display: grid;
            color: #131924;
        }
        .total{
            display: flex;
            justify-content: flex-end;
            margin-top: 1.5rem;
            border-top: 2px solid var(--text-color);    
        }
        .total-title{
            font-size: 1rem;
            font-weight: 600;
            color: var(--main-color);
        }
        .total-price{
            margin-left: .5rem;
            color: var(--main-color);
        }
        .btn-buy{
            display: flex;
            margin: 1.5rem auto 0 auto;
            padding: 12px 20px;
            border: none;
            background: var(--main-color);
            color: var(--bg-color);
            font-size: 1rem;
            font-weight: 500;
            transition: .4s ease;
        }
        .btn-buy:hover{
            background: #3c3c3c;
            color: #ffffff;
        }
        #close-cart{
            position: absolute;   
            top: 1.2rem;
            right: 1.1rem;
            font-size: 2rem;
            color: var(--text-color);
        }
        .section-title{
            font-size: 2.5rem;
            font-weight: 600;
            margin-top: 120px;
            margin-bottom: 1.5rem;
        }
        .search{
            display: flex;
            align-items: center;
            width: 300px;
            height: 40px;
            background-color: #131924;
            border-radius: 2px;
            padding: 3px;
            margin-bottom: 20px;
        }
        .search > i{
            font-size: 20px;
            color: var(--main-color);
            padding: 10px;
        }
        .search > input{
            flex: 1;
            height: 20px;
            border: none;
            outline: none;
            font-size: 12px;
            background: transparent;
            color: #fff;
        }
        .search_bx2{
            width: 200px;
            height: 20px;
            color: rgb(0, 0, 0);
            border: 1px solid #fff;
        }
        .shop {
            margin-top: 2rem;
        }
        .shop-content{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px,auto));
            gap: 1.5rem;
            margin-bottom: 45px;
            
        }
        .product-box{
            position: relative;
            border-radius: 4px;
        }
        .product-box:hover{
            padding: 5px;
            /* border: 1px solid var(--text-color); */
            transition: 0.4s ease;
        }
        .product-title{
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            
        }
        .product-desc,.product-type{
            font-size: .9rem;
            font-weight: 500;
            text-transform: capitalize;
            color: #686868;
            margin-bottom: 0.5rem;
        }
        .price{
            font-weight: 500;
            color: var(--main-color);
        }
        .add-cart{
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--text-color);
            color: var(--bg-color);
            padding: 10px;
        }
        .add-cart:hover{
            background: hsl(251, 28%, 24%);
        }

        .desc_cont{
            color: #686868;
            text-align:justify;
            word-break:keep-all;
        }

        .borderline{
         
            width: 100%;
            border: 1px solid #949494;
        }

        .sell_btn{
            color: #515151;
            text-align:justify;
            word-break:keep-all;
            font-weight: 600;
        }


        .CategoryList label{
            display: block;
            padding: 4px 0;
        }

        /* Filter feature */
        .dropdown {
            position: relative;
            display: inline-block; 

        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #ffffff;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: .5em;

        }

        .dropdown-content label {
            padding: 8px 16px;
            display: block;
            cursor: pointer;
            color: #202020;
        }

        .dropdown-content label:hover {
            background-color: #171427c8;
            color: #ffffff;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown:hover .dropbtn {
            background-color: #171427de;
            color: #ffffff;
        } 

        .dropbtn {
            background-color: #131924;
            color: white;
            padding: 10px;
            font-size: 14px;
            border: none;
            border-radius: 2px; 
            margin-bottom: 20px;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            font-weight: 600;
            cursor: url(../image/cursor.png), auto;
        }

        .searchContainer{
            display: flex;
            justify-content: space-between;
            
        }


        @media (max-width:1080px){
            .nav {
                padding:15px;
            }
            section{
                padding: 3rem 0 2rem;
            }
            .container {
                margin: 0 auto;
                width: 90%;
            }
            .shop{
                margin-top: 2rem !important;
            }
            .searchContainer{
                display: grid;
                padding: 10px;
            }
            .filterbox{
                margin-top: 20px;
            }

            #filter-container{
                width: 170px;
            }
        }
        @media (max-width:400px){
            .nav{
                padding: 11px;
            }
            .logo{
                font-size: 1rem;
            }
            .cart{
                width: 320px;
            }
            .section-title{
                margin-top: 2px;
            }
            
        }
        @media (max-width:360px){
            .shop{
                margin-top: 1rem !important;
            }
            .cart{
                width: 280px;
            }
        }

        .imagecontent{
            display: flex;
            margin-bottom: 20px;
            gap: 20px;
        }


        .price-filter {
            display: flex;
            align-items: center;
            height: 40px;
            padding: 8px;
            background: #131924; /* Matches the background color */
            border: 1px solid var(--text-color);
            border-radius: 2px;
            margin-bottom: 20px;
            width: 300px;
        }


        .price-filter label {
            display: block;
            padding-top: 5px;
            font-size: 0.9rem; /* Reduced font size */
            font-weight: 500; /* Slightly lighter weight */
            margin-bottom: 6px;
            text-transform: uppercase;
            color: var(--bg-color);
        }


        #priceRange {
            width: 50%;
            -webkit-appearance: none; /* Remove default styling */
            background: var(--bg-color);
            height: 5px; /* Reduced height */
            border-radius: 4px; /* Reduced border radius */
            outline: none;
            margin-left: 20px;
            margin-right: 20px;
        }

        #priceRange::-webkit-slider-thumb {
            -webkit-appearance: none; /* Remove default styling */
            appearance: none;
            width: 12px; /* Reduced thumb width */
            height: 12px; /* Reduced thumb height */
            background: #7499d8;
            cursor: pointer;
            border-radius: 50%;
        }

        #priceRange::-moz-range-thumb {
            width: 10px;
            height: 10px;
            background: var(--text-color);
            cursor: pointer;
            border-radius: 50%;
        }
        .bxs-filter-alt{
            margin-left: 5px;
            font-size: 1rem;
            align-items: center;
        }

        #priceValue {
            width: 50%;
            border-radius: 5px;
            padding: 3px;
            color: var(--main-color);
            font-size: 0.7rem; 
            box-sizing: border-box;
            align-items: center; 
            background-color: #f1f1f1;

        }

        .price-filter input[type="number"] {
            width: 100%;
            box-sizing: border-box;
        }

        #filter-container{
            background: #171427;
            height: 40px;
            border-radius: 2px;
            padding-top: 6px;
            padding-right: 10px;
            padding-left: 10px;
        }

        .sort-price{
            color: #ffffff;
            font-size: .9rem;
            font-weight: 600;
            margin-right: 5px;
            background: #131924;

        }

        #sort-price{
                border-radius: 5px;
                padding: 3px;
                color: var(--main-color);
                font-size: 0.7rem;
                box-sizing: border-box;
                align-items: center; 
                background-color: #f1f1f1;
        }

        .qty{
            color: #131924;
        }

        .quantity-input{
            width: 30px;
            height: 30px;
            color: #fff;
            background-color: #171427;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .alert {
            top: 122px;
            right: 30px;
            text-align: center;
            padding: 15px;
            width: fit-content;
            background-color: #6375ffb5;
            color: white;
            border-radius: 5px;
            z-index: 2;
            padding: 20px;
            position: fixed;
            right: 20px;
            animation: slideIn 0.5s forwards, slideOut 0.5s 4.5s forwards; /* Slide in and out */
        }

        .alert.success {
            background-color: #6375ffb5;
        }

     </style>

    <!-- Font -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>
<body>
    {{#if successMessage}}
        <div class="alert success">{{successMessage}}</div>
    {{/if}}

    {{#if errorMessage}}
        <div class="alert">{{errorMessage}}</div>
    {{/if}}
    <!-- Header -->
    <header>
        <div class="nav container">
            <a href="./login" class="logo" onmousedown="audio.play();">Mafia</a>
            <i class="bx bx-shopping-bag" id="cart-icon"></i>
            <div class="cart">
                <div class="cart-content">
                    {{> cart}}
                </div>
            </div>
        </div>
    </header>
    
    <section class="shop container">
        
        <h2 class="section-title">GTA 5 | Exclusive Collection</h2>
        <p class="desc_cont">Welcome to your ultimate black-market paradise, inspired by the gritty streets of Los Santos. 
            Step into our immersive dashboard and experience the thrill of the underworld with our 
            exclusive selection of luxury cars, prime real estate, high-end bikes, and state-of-the-art 
            weaponry. Our marketplace offers everything you need to dominate the city, just like in GTA 5. 
            Navigate through our dark-themed interface, designed to give you the authentic feel of the game, and secure your place among the elite with our premium offerings. 
            <p class="sell_btn">Want to sell your luxury? <a href="./sell">Click Here <i class='bx bx-link-external'></i></a></p><br>
            <div class="borderline"></div>
            <br><br>
        </p>
        
        <div class="searchContainer">
        {{!-- Search Box --}}
            <div class="search">
                <i class="bx bx-search" id="cart-icon"></i>
                <input type="text" id="search-item" placeholder="Search Model" onkeyup="search()">
            </div>

            <div class="price-filter">
                <label for="priceRange" class="price-budget">Budget</label>
                <input type="range" id="priceRange" min="0" step="0.01">
                <input type="number" id="priceValue" step="0.01" min="0">
            </div>


                <div id="filter-container">
                    <label for="sort-price" class="sort-price">SORT</label>
                    <select id="select">
                        <option value="default">Default</option>
                        <option value="LowToHigh">Low to High</option>
                        <option value="HighToLow">High to Low</option>
                    </select>
                </div>

                <div class="filterbox">
                <div class="dropdown">
                    <button class="dropbtn">APPLY FILTER<i class='bx bxs-filter-alt' style='color:#ffffff'></i></button>
                    <div class="dropdown-content CategoryList">
                        <ul>
                            {{!-- 
                            <li>
                                <label>
                                    Mens 
                                    <input type="checkbox">
                                    <span class="check"></span>
                                </label>
                            </li>
                             --}}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="shop-content" >
            {{#each products}}
                <div class="product-box" data-price={{this.price}}>
                    <img src="/uploads/{{this.imageurl}}" alt="{{this.title}}" class="product-img">
                    <h2 class="product-title">{{this.title}}</h2>
                    <h3 class="product-desc">{{this.description}}</h3>
                    <h3 class="product-type">{{this.type}}</h3>
                    <span class="price">${{this.price}}</span>
                    <form action="/cart/add" method="POST" class="add-to-cart-form">
                        <input type="hidden" name="productId" value="{{this._id}}">
                        <input type="number" name="quantity" value="1" min="1" class="quantity-input" hidden>
                        <button type="submit" class="add-cart"><i class="bx bx-shopping-bag" id="cart-icon"></i></button>
                    </form>
                </div>
            {{/each}}
        </div>
    </section>

    {{!-- sort by user's Budget --}}
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const successMessage = "{{successMessage}}";
            const errorMessage = "{{errorMessage}}";

            // Get all the product prices
            const prices = Array.from(document.querySelectorAll('.product-box'))
                .map(product => parseFloat(product.getAttribute('data-price')));

            // Determine the min and max prices
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);

            // Get the input elements
            const priceRange = document.getElementById('priceRange');
            const priceValue = document.getElementById('priceValue');

            // Set the min and max values for the inputs
            priceRange.min = minPrice;
            priceRange.max = maxPrice;
            priceValue.min = minPrice;
            priceValue.max = maxPrice;

            // Set initial values
            priceRange.value = maxPrice;
            priceValue.value = maxPrice;

            // Event listeners for synchronizing the inputs
            priceRange.addEventListener('input', () => {
                priceValue.value = priceRange.value;
                filterProductsByPrice(priceRange.value);
            });

            priceValue.addEventListener('input', () => {
                if (priceValue.value > maxPrice) priceValue.value = maxPrice;
                if (priceValue.value < minPrice) priceValue.value = minPrice;
                priceRange.value = priceValue.value;
                filterProductsByPrice(priceValue.value);
            });

            // Function to filter products by price
            function filterProductsByPrice(maxPrice) {
                const productBoxes = document.querySelectorAll('.product-box');
                productBoxes.forEach(box => {
                    const productPrice = parseFloat(box.getAttribute('data-price'));
                    if (productPrice <= maxPrice) {
                        box.style.display = 'block';
                    } else {
                        box.style.display = 'none';
                    }
                });
            }
        });

    </script>

    {{!-- Filter feature --}}
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const products = Array.from(document.querySelectorAll(".product-box"));
            const categories = [...new Set(products.map(product => product.querySelector(".product-type").textContent.trim()))];

            const categoryList = document.querySelector(".CategoryList ul");

            categories.forEach(category => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <label>
                        ${category}
                        <input type="checkbox" class="category-checkbox" value="${category}">
                        <span class="check"></span>
                    </label>
                `;
                categoryList.appendChild(li);
            });

            const checkboxes = Array.from(document.querySelectorAll(".category-checkbox"));

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener("change", filterProducts);
            });

            function filterProducts() {
                const selectedCategories = checkboxes
                    .filter(checkbox => checkbox.checked)
                    .map(checkbox => checkbox.value);

                if (selectedCategories.length === 0) {
                    products.forEach(product => product.style.display = "");
                } else {
                    products.forEach(product => {
                        const productCategory = product.querySelector(".product-type").textContent.trim();
                        if (selectedCategories.includes(productCategory)) {
                            product.style.display = "";
                        } else {
                            product.style.display = "none";
                        }
                    });
                }
            }
        });

    </script>
    {{!-- Search Tools --}}
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const sortSelect = document.getElementById('select');
            const productContainer = document.querySelector('.shop-content');
            const products = Array.from(productContainer.querySelectorAll('.product-box'));

            // Store the initial order of the products
            const initialProductsOrder = products.map(product => product.outerHTML);

            sortSelect.addEventListener('change', function() {
                const sortOption = this.value;

                if (sortOption === 'LowToHigh') {
                    products.sort((a, b) => parseFloat(a.dataset.price) - parseFloat(b.dataset.price));
                } else if (sortOption === 'HighToLow') {
                    products.sort((a, b) => parseFloat(b.dataset.price) - parseFloat(a.dataset.price));
                } else if (sortOption === 'default') {
                    productContainer.innerHTML = initialProductsOrder.join('');
                    return; // Exit the function early
                }

                // Clear the current product list
                productContainer.innerHTML = '';

                // Append the sorted products back to the container
                products.forEach(product => productContainer.appendChild(product));
            });
        });


    </script>


    {{!-- Search and Cart Open Feature --}}
    <script>
        let cartIcon = document.querySelector("#cart-icon");
        let cart = document.querySelector(".cart");
        let closeCart = document.querySelector("#close-cart");

        cartIcon.onclick = () => {
            fetch('cart')
                .then(response => response.text())
                .then(data => {
                    cart.innerHTML = data;
                    cart.classList.add("active");
                })
                .catch(error => console.error('Error loading cart:', error));
        };

        closeCart.onclick = () => {
            cart.classList.remove("active");
        };

        if (document.readyState == 'loading'){
            document.addEventListener("DOMContentLoaded", ready);
        } else {
            ready();
        }

        function search() {
            const searchInput = document.getElementById('search-item').value.toUpperCase();
            const productBoxes = document.querySelectorAll('.product-box');
            productBoxes.forEach(box => {
                const title = box.querySelector('.product-title').innerText.toUpperCase();
                if (title.indexOf(searchInput) > -1) {
                    box.style.display = '';
                } else {
                    box.style.display = 'none';
                }
            });
        }

        var audio = new Audio();
        audio.src='audio/click.mp3';
        var error = new Audio();
        error.src = 'audio/error.mp3';

    </script>
</body>
</html>