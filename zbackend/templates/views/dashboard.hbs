<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia - Dashboard</title>

    <!-- CSS LINK -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
        *{
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            scroll-padding-top: 2rem;
            scroll-behavior: smooth;
            box-sizing: border-box;
            list-style: none;
            text-decoration: none;
    
            cursor: url(../image/cursor.png), auto;
        }

        body{
            background-color: #f1f1f1;
        }
        h2{
            color: #171427;
        }
        

        :root{
            --main-color: #131924;
            --text-color: #131924;
            --bg-color: #fff;
        }
        body::-webkit-scrollbar{
            display: none;
        }
        img{
            width: 100%;
        }
        .container{
            max-width: 1068px;
            margin: auto;
            width: 100%;
            color: #fff;
        }
        header{
            position: fixed;
            color: #fff;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--text-color);
            box-shadow: 0 1px 4px hsl(0 4% 15% / 10%);
            z-index: 100;
        }
        .nav{
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
        }
        .textnew{
            color: white;
        }
        .nav i{
            color: #171427;
        }
        .logo{
            font-size: 2rem;
            color: var(--bg-color);
            font-weight: 600;
        }
        .navlist{
            color: #fff;
        }
        .navlist{
            justify-content: space-around;
        }
        #cart-icon{
            font-size: 1.5rem;
            color: #fff;
        }
        .cart{
            position: fixed;
            top: 0;
            right: -100%;
            width: 360px;
            min-height: 100vh;
            padding: 20px;
            background: var(--bg-color);
            box-shadow: -2px 0 4px hsl(0 4% 15% / 10%);
            transition: .3s ease;
        }
        .cart.active{
            right: 0;
        }
        .cart-title{
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1rem;
            color: var(--main-color);
        }

        .cart-content{
            color: var(--main-color);
            width: 800;
        }
        .cart-box{
            display: grid;
            grid-template-columns: 32% 50% 18%;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        .cart-img{
            width: 100px;
            height: 100px;
            object-fit: contain;
            padding: 10px;
        }
        .cart-price{
            font-weight: 500;
        }
        .cart-quantity{
            outline-color: var(--main-color);
            width: 2.4rem;
            text-align: center;
            font-size: 1rem;
        }
        .cart-remove {
            font-size: 24px;
            cursor: pointer;
        }
        .cart-product-title{
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .detail-box{
            display: grid;
            color: #131924;
        }
        .total{
            display: flex;
            justify-content: flex-end;
            margin-top: 1.5rem;
            border-top: 2px solid var(--text-color);    
        }
        .total-title{
            font-size: 1rem;
            font-weight: 600;
            color: var(--main-color);
        }
        .total-price{
            margin-left: .5rem;
            color: var(--main-color);
        }
        .btn-buy{
            display: flex;
            margin: 1.5rem auto 0 auto;
            padding: 12px 20px;
            border: none;
            background: var(--main-color);
            color: var(--bg-color);
            font-size: 1rem;
            font-weight: 500;
            transition: .4s ease;
        }
        .btn-buy:hover{
            background: #3c3c3c;
            color: #ffffff;
        }
        #close-cart{
            position: absolute;   
            top: 1.2rem;
            right: 1.1rem;
            font-size: 2rem;
            color: var(--text-color);
        }
        .section-title{
            font-size: 2.5rem;
            font-weight: 600;
            margin-top: 120px;
            margin-bottom: 1.5rem;
        }
        .search{
            display: flex;
            align-items: center;
            width: 300px;
            height: 40px;
            background-color: #131924;
            border-radius: 2px;
            padding: 3px;
            margin-bottom: 20px;
        }
        .search > i{
            font-size: 20px;
            color: var(--main-color);
            padding: 10px;
        }
        .search > input{
            flex: 1;
            height: 20px;
            border: none;
            outline: none;
            font-size: 12px;
            background: transparent;
            color: #fff;
        }
        .search_bx2{
            width: 200px;
            height: 20px;
            color: rgb(0, 0, 0);
            border: 1px solid #fff;
        }
        .shop {
            margin-top: 2rem;
        }
        .shop-content{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px,auto));
            gap: 1.5rem;
            margin-bottom: 45px;
            
        }
        .product-box{
            position: relative;
            border-radius: 4px;
        }
        .product-box:hover{
            padding: 5px;
            /* border: 1px solid var(--text-color); */
            transition: 0.4s ease;
        }
        .product-title{
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            
        }
        .product-desc,.product-type{
            font-size: .9rem;
            font-weight: 500;
            text-transform: capitalize;
            color: #686868;
            margin-bottom: 0.5rem;
        }
        .price{
            font-weight: 500;
            color: var(--main-color);
        }
        .add-cart{
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--text-color);
            color: var(--bg-color);
            padding: 10px;
        }
        .add-cart:hover{
            background: hsl(251, 28%, 24%);
        }

        .desc_cont{
            color: #686868;
            text-align:justify;
            word-break:keep-all;
        }

        .borderline{
         
            width: 100%;
            border: 1px solid #949494;
        }

        .sell_btn{
            color: #515151;
            text-align:justify;
            word-break:keep-all;
            font-weight: 600;
        }


        .CategoryList label{
            display: block;
            padding: 4px 0;
        }

        /* Filter feature */
        .dropdown {
            position: relative;
            display: inline-block; 

        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #ffffff;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: .5em;

        }

        .dropdown-content label {
            padding: 8px 16px;
            display: block;
            cursor: pointer;
            color: #202020;
        }

        .dropdown-content label:hover {
            background-color: #171427c8;
            color: #ffffff;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown:hover .dropbtn {
            background-color: #171427de;
            color: #ffffff;
        } 

        .dropbtn {
            background-color: #131924;
            color: white;
            padding: 10px;
            font-size: 14px;
            border: none;
            border-radius: 2px; 
            margin-bottom: 20px;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            font-weight: 600;
            cursor: url(../image/cursor.png), auto;
        }

        .searchContainer{
            display: flex;
            justify-content: space-between;
            
        }


        @media (max-width:1080px){
            .nav {
                padding:15px;
            }
            section{
                padding: 3rem 0 2rem;
            }
            .container {
                margin: 0 auto;
                width: 90%;
            }
            .shop{
                margin-top: 2rem !important;
            }
            .searchContainer{
                display: grid;
                padding: 10px;
            }
            .filterbox{
                margin-top: 20px;
            }

            #filter-container{
                width: 170px;
            }
        }
        @media (max-width:400px){
            .nav{
                padding: 11px;
            }
            .logo{
                font-size: 1rem;
            }
            .cart{
                width: 320px;
            }
            .section-title{
                margin-top: 2px;
            }
            
        }
        @media (max-width:360px){
            .shop{
                margin-top: 1rem !important;
            }
            .cart{
                width: 280px;
            }
        }

        .imagecontent{
            display: flex;
            margin-bottom: 20px;
            gap: 20px;
        }


        .price-filter {
            display: flex;
            align-items: center;
            height: 40px;
            padding: 8px;
            background: #131924; /* Matches the background color */
            border: 1px solid var(--text-color);
            border-radius: 2px;
            margin-bottom: 20px;
            width: 300px;
        }


        .price-filter label {
            display: block;
            padding-top: 5px;
            font-size: 0.9rem; /* Reduced font size */
            font-weight: 500; /* Slightly lighter weight */
            margin-bottom: 6px;
            text-transform: uppercase;
            color: var(--bg-color);
        }


        #priceRange {
            width: 50%;
            -webkit-appearance: none; /* Remove default styling */
            background: var(--bg-color);
            height: 5px; /* Reduced height */
            border-radius: 4px; /* Reduced border radius */
            outline: none;
            margin-left: 20px;
            margin-right: 20px;
        }

        #priceRange::-webkit-slider-thumb {
            -webkit-appearance: none; /* Remove default styling */
            appearance: none;
            width: 12px; /* Reduced thumb width */
            height: 12px; /* Reduced thumb height */
            background: #7499d8;
            cursor: pointer;
            border-radius: 50%;
        }

        #priceRange::-moz-range-thumb {
            width: 10px;
            height: 10px;
            background: var(--text-color);
            cursor: pointer;
            border-radius: 50%;
        }
        .bxs-filter-alt{
            margin-left: 5px;
            font-size: 1rem;
            align-items: center;
        }

        #priceValue {
            width: 50%;
            border-radius: 5px;
            padding: 3px;
            color: var(--main-color);
            font-size: 0.7rem; 
            box-sizing: border-box;
            align-items: center; 
            background-color: #f1f1f1;

        }

        .price-filter input[type="number"] {
            width: 100%;
            box-sizing: border-box;
        }

        #filter-container{
            background: #171427;
            height: 40px;
            border-radius: 2px;
            padding-top: 6px;
            padding-right: 10px;
            padding-left: 10px;
        }

        .sort-price{
            color: #ffffff;
            font-size: .9rem;
            font-weight: 600;
            margin-right: 5px;
            background: #131924;

        }

        #sort-price{
                border-radius: 5px;
                padding: 3px;
                color: var(--main-color);
                font-size: 0.7rem;
                box-sizing: border-box;
                align-items: center; 
                background-color: #f1f1f1;
        }

        .qty{
            color: #131924;
        }

        .quantity-input{
            width: 30px;
            height: 30px;
            color: #fff;
            background-color: #171427;
        }
     </style>

    <!-- Font -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav container">
            <a href="./login" class="logo" onmousedown="audio.play();">Mafia</a>
            <i class="bx bx-shopping-bag" id="cart-icon"></i>
            <div class="cart">
                <div class="cart-content">
                    {{> cart}}
                </div>
            </div>
        </div>
    </header>
    
    <section class="shop container">
        
        <h2 class="section-title">GTA 5 | Exclusive Collection</h2>
        <p class="desc_cont">Welcome to your ultimate black-market paradise, inspired by the gritty streets of Los Santos. 
            Step into our immersive dashboard and experience the thrill of the underworld with our 
            exclusive selection of luxury cars, prime real estate, high-end bikes, and state-of-the-art 
            weaponry. Our marketplace offers everything you need to dominate the city, just like in GTA 5. 
            Navigate through our dark-themed interface, designed to give you the authentic feel of the game, and secure your place among the elite with our premium offerings. 
            <p class="sell_btn">Want to sell your luxury? <a href="./sell">Click Here <i class='bx bx-link-external'></i></a></p><br>
            <div class="borderline"></div>
            <br><br>
        </p>
        
        <div class="searchContainer">
        {{!-- Search Box --}}
            <div class="search">
                <i class="bx bx-search" id="cart-icon"></i>
                <input type="text" id="search-item" placeholder="Search Model" onkeyup="search()">
            </div>

            <div class="price-filter">
                <label for="priceRange" class="price-budget">Budget</label>
                <input type="range" id="priceRange" min="0" step="0.01">
                <input type="number" id="priceValue" step="0.01" min="0">
            </div>


                <div id="filter-container">
                    <label for="sort-price" class="sort-price">SORT</label>
                    <select id="sort-price">
                        <option value="default">Sort By Price</option>
                        <option value="low-to-high">Low to High</option>
                        <option value="high-to-low">High to Low</option>
                    </select>
                </div>

                <div class="filterbox">
                <div class="dropdown">
                    <button class="dropbtn">APPLY FILTER<i class='bx bxs-filter-alt' style='color:#ffffff'></i></button>
                    <div class="dropdown-content CategoryList">
                        <!-- The category list items will be dynamically populated by JavaScript -->
                    </div>
                </div>
            </div>

        </div>

        <div class="shop-content" id="shop-content">
            {{#each products}}
                <div class="product-box">
                    <img src="/uploads/{{this.imageurl}}" alt="{{this.title}}" class="product-img">
                    <h2 class="product-title">{{this.title}}</h2>
                    <h3 class="product-desc">{{this.description}}</h3>
                    <h3 class="product-type">{{this.type}}</h3>
                    <span class="price">${{this.price}}</span>
                    <form action="/cart/add" method="POST" class="add-to-cart-form">
                        <input type="hidden" name="productId" value="{{this._id}}">
                        <input type="number" name="quantity" value="1" min="1" class="quantity-input" hidden>
                        <button type="submit" class="add-cart"><i class="bx bx-shopping-bag" id="cart-icon"></i></button>
                    </form>
                </div>
            {{/each}}
        </div>
    </section>

    <script>
        let cartIcon = document.querySelector("#cart-icon");
        let cart = document.querySelector(".cart");
        let closeCart = document.querySelector("#close-cart");

        cartIcon.onclick = () => {
            fetch('cart')
                .then(response => response.text())
                .then(data => {
                    cart.innerHTML = data;
                    cart.classList.add("active");
                })
                .catch(error => console.error('Error loading cart:', error));
        };

        closeCart.onclick = () => {
            cart.classList.remove("active");
        };

        if (document.readyState == 'loading'){
            document.addEventListener("DOMContentLoaded", ready);
        } else {
            ready();
        }

        function buyButtonClicked(){
            alert("Your Order is Placed");
            var cartContent = document.getElementsByClassName("cart-content")[0];
            while(cartContent.hasChildNodes()){
                cartContent.removeChild(cartContent.firstChild);
            }
            updatetotal();
        }


        function updatetotal() {
            var cartContent = document.getElementsByClassName('cart-content')[0];
            var cartBoxes = cartContent.getElementsByClassName('cart-box');
            var total = 0;
            for( var i = 0; i < cartBoxes.length; i++){
                var cartBox = cartBoxes[i];
                var priceElement = cartBox.getElementsByClassName('cart-price')[0];
                var quantityElement = cartBox.getElementsByClassName('cart-quantity')[0];
                var price = parseFloat(priceElement.innerText.replace("$", ""));
                var quantity = quantityElement.value;
                total = total + (price * quantity);
            }
            total = Math.round(total * 100) / 100;
            document.getElementsByClassName("total-price")[0].innerText = "$" + total;
        }

        function populateCategories() {
            const productTypes = document.querySelectorAll('.product-type');
            const categories = new Set();
            
            productTypes.forEach(typeElement => {
                const categoryText = typeElement.innerText.replace("Type: ", "").trim();
                if (categoryText !== "") {
                    categories.add(categoryText);
                }
            });

            const categoryListDiv = document.querySelector('.CategoryList');
            categories.forEach(category => {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = category;
                checkbox.addEventListener('change', filterProducts);
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(category));
                categoryListDiv.appendChild(label);
            });
        }

        function filterProducts() {
            const checkboxes = document.querySelectorAll('.CategoryList input[type="checkbox"]');
            const checkedCategories = [];
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    checkedCategories.push(checkbox.value);
                }
            });

            const productBoxes = document.querySelectorAll('.product-box');
            productBoxes.forEach(box => {
                const productType = box.querySelector('.product-type').innerText.replace("Type: ", "").trim();
                if (checkedCategories.length === 0 || checkedCategories.includes(productType)) {
                    box.style.display = 'block';
                } else {
                    box.style.display = 'none';
                }
            });
        }

        function search() {
            const searchInput = document.getElementById('search-item').value.toUpperCase();
            const productBoxes = document.querySelectorAll('.product-box');
            productBoxes.forEach(box => {
                const title = box.querySelector('.product-title').innerText.toUpperCase();
                if (title.indexOf(searchInput) > -1) {
                    box.style.display = '';
                } else {
                    box.style.display = 'none';
                }
            });
        }



        // =============================NEW==============================


        // Product sort by budget 

document.addEventListener('DOMContentLoaded', () => {
            // Category filter functionality
            function populateCategories() {
                const categories = new Set();
                const products = document.querySelectorAll('.product-box');
                products.forEach(product => {
                    categories.add(product.dataset.category);
                });
                
                const categoryDropdown = document.getElementById('categoryDropdown');
                categories.forEach(category => {
                    const label = document.createElement('label');
                    label.innerHTML = `<input type="checkbox" class="category-filter" value="${category}"> ${category}`;
                    categoryDropdown.appendChild(label);
                });

                document.querySelectorAll('.category-filter').forEach(checkbox => {
                    checkbox.addEventListener('change', filterProductsByCategory);
                });
            }

            function filterProductsByCategory() {
                const selectedCategories = Array.from(document.querySelectorAll('.category-filter:checked')).map(cb => cb.value);
                const products = document.querySelectorAll('.product-box');
                products.forEach(product => {
                    if (selectedCategories.length === 0 || selectedCategories.includes(product.dataset.category)) {
                        product.style.display = '';
                    } else {
                        product.style.display = 'none';
                    }
                });
            }

            // Price sorting functionality
            const sortPriceSelect = document.querySelectorAll('input[name="sortPrice"]');
            sortPriceSelect.forEach(radio => {
                radio.addEventListener('change', event => {
                    sortProductsByPrice(event.target.value);
                });
            });

            function sortProductsByPrice(order) {
                const productsContainer = document.querySelector('.shop-content');
                const products = Array.from(productsContainer.children);

                products.sort((a, b) => {
                    const priceA = parseFloat(a.querySelector('.price').textContent.replace('$', ''));
                    const priceB = parseFloat(b.querySelector('.price').textContent.replace('$', ''));
                    return order === 'lowToHigh' ? priceA - priceB : priceB - priceA;
                });

                productsContainer.innerHTML = '';
                products.forEach(product => productsContainer.appendChild(product));
            }

            // Update price range value display and filter products based on price range
            const priceRange = document.getElementById('priceRange');
            const priceValue = document.getElementById('priceValue');

            priceRange.addEventListener('input', () => {
                priceValue.value = priceRange.value;
                filterProductsByPrice(priceRange.value);
            });

            priceValue.addEventListener('input', () => {
                priceRange.value = priceValue.value;
                filterProductsByPrice(priceValue.value);
            });

            function filterProductsByPrice(maxPrice) {
                const products = document.querySelectorAll('.product-box');
                products.forEach(product => {
                    const price = parseFloat(product.querySelector('.price').textContent.replace('$', ''));
                    if (price <= maxPrice || maxPrice === '') {
                        product.style.display = '';
                    } else {
                        product.style.display = 'none';
                    }
                });
            }

            // Initial population of categories and price range max value
            populateCategories();
            const maxPrice = Math.max(...Array.from(document.querySelectorAll('.price')).map(priceElement => parseFloat(priceElement.textContent.replace('$', ''))));
            priceRange.max = maxPrice;
            priceValue.max = maxPrice;
        });









        var audio = new Audio();
        audio.src='audio/click.mp3';
        var error = new Audio();
        error.src = 'audio/error.mp3';

    </script>
</body>
</html>